<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>..//GENFIRE/gui/VolumeSlicer</title>
  <meta name="description" content="GENFIRE Documentation">
  <meta name="author" content="Alan (AJ) Pryor, Jr.">  <link rel="stylesheet" href="css/styles.css?v=1.0">
  <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>
<code>"""<br>* GENFIRE.gui.VolumeSlicer *<br><br>The volume slicer module<br><br><br>Author: Alan (AJ) Pryor, Jr.<br>Jianwei (John) Miao Coherent Imaging Group<br>University of California, Los Angeles<br>Copyright 2015-2016. All rights reserved.<br>"""<br><br><font color="orange">from </font><b><font color="orange">GENFIRE</font></b>.g<font color="orange">ui </font><font color="orange">import </font>VolumeSlicer_MainWindow<br><font color="orange">from </font>PyQt4 <font color="orange">import </font>QtCore, QtG<font color="orange">ui<br></font><font color="orange">import </font>matplotlib<br>matplotlib.use("Qt4Agg")<br><font color="orange">import </font>matplotlib.pyplot as <font color="orange">plt<br></font><font color="orange">from </font>matplotlib.backends.backend_qt4agg <font color="orange">import </font>FigureCanvasQTAgg as FigureCanvas<br><font color="orange">from </font>matplotlib.backends.backend_qt4agg <font color="orange">import </font>NavigationToolbar2QT as NavigationToolbar<br><font color="orange">import </font>numpy as np<br><font color="orange">from </font>functools <font color="orange">import </font>partial<br><font color="orange">from </font><b><font color="orange">GENFIRE</font></b>.g<font color="orange">ui.</font>utility <font color="orange">import </font>toString, toQString, toInt, toFloat<br><br><br><font color="orange">class </font>VolumeSlicer(<font color="orange">QtG<font color="orange">ui.</font></font>QMainWindow):<br>    <font color="orange">def </font>__init__(self, volume):<br>        super(VolumeSlicer, self).__init__()<br>        <font color="orange">self.</font>volume = volume<br>        <font color="orange">self.</font><font color="orange">ui </font>= VolumeSlicer_MainWindow.Ui_VolumeSlicer()<br>        <font color="orange">self.</font><font color="orange">ui.</font>setupUi(self) # build interface<br><br>        <font color="orange">self.</font><font color="orange">ui.</font>checkBox_lockcmap.toggled.connect(<font color="orange">self.</font>toggleLockCmap)<br>        <font color="orange">self.</font>lockColormap = <font color="orange">False<br></font>        <font color="orange">self.</font><font color="orange">ui.</font>checkBox_lockcmap.setChecked(False)<br><br>        # figures for plotting<br>        <font color="orange">self.</font>fig1 = <font color="orange">plt.</font>figure()<br>        <font color="orange">self.</font>fig2 = <font color="orange">plt.</font>figure()<br>        <font color="orange">self.</font>fig3 = <font color="orange">plt.</font>figure()<br><br>        # canvases link the Qt widgets with the matplotlib figures<br>        <font color="orange">self.</font>canvas1 = FigureCanvas(<font color="orange">self.</font>fig1)<br>        <font color="orange">self.</font>canvas2 = FigureCanvas(<font color="orange">self.</font>fig2)<br>        <font color="orange">self.</font>canvas3 = FigureCanvas(<font color="orange">self.</font>fig3)<br><br>        <font color="orange">self.</font>slice1 = <font color="orange">self.</font>fig1.add_subplot(111)<br>        <font color="orange">self.</font>slice2 = <font color="orange">self.</font>fig2.add_subplot(111)<br>        <font color="orange">self.</font>slice3 = <font color="orange">self.</font>fig3.add_subplot(111)<br><br>        <font color="orange">self.</font>slice1.hold(False)<br>        <font color="orange">self.</font>slice2.hold(False)<br>        <font color="orange">self.</font>slice3.hold(False)<br><br>        <font color="orange">self.</font>navigationToolbar1 = NavigationToolbar(<font color="orange">self.</font>canvas1, self)<br>        <font color="orange">self.</font>navigationToolbar2 = NavigationToolbar(<font color="orange">self.</font>canvas2, self)<br>        <font color="orange">self.</font>navigationToolbar3 = NavigationToolbar(<font color="orange">self.</font>canvas3, self)<br><br>        <font color="orange">self.</font><font color="orange">ui.</font>vt_lyt_fig1.addWidget(<font color="orange">self.</font>navigationToolbar1)<br>        <font color="orange">self.</font><font color="orange">ui.</font>vt_lyt_fig1.addWidget(<font color="orange">self.</font>canvas1)<br>        <font color="orange">self.</font><font color="orange">ui.</font>vt_lyt_fig2.addWidget(<font color="orange">self.</font>navigationToolbar2)<br>        <font color="orange">self.</font><font color="orange">ui.</font>vt_lyt_fig2.addWidget(<font color="orange">self.</font>canvas2)<br>        <font color="orange">self.</font><font color="orange">ui.</font>vt_lyt_fig3.addWidget(<font color="orange">self.</font>navigationToolbar3)<br>        <font color="orange">self.</font><font color="orange">ui.</font>vt_lyt_fig3.addWidget(<font color="orange">self.</font>canvas3)<br><br>        dimx, dimy, dimz = np.shape(volume)<br>        ncx,  ncy,  ncz  = dimx//2., dimy//2, dimz//2<br>        ncx,  ncy,  ncz  = int(ncx), int(ncy), int(ncz)<br><br>        # use of partial allows binding functions to arguments to prevent having to avoid extra parameter forwarding<br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig1.valueChanged.connect(partial(<font color="orange">self.</font>setTextFromSlider,<font color="orange">self.</font><font color="orange">ui.</font>lineEdit_scrlbr1))<br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig2.valueChanged.connect(partial(<font color="orange">self.</font>setTextFromSlider,<font color="orange">self.</font><font color="orange">ui.</font>lineEdit_scrlbr2))<br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig3.valueChanged.connect(partial(<font color="orange">self.</font>setTextFromSlider,<font color="orange">self.</font><font color="orange">ui.</font>lineEdit_scrlbr3))<br><br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig1.setValue(ncx)<br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig1.setMinimum(0)<br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig1.setMaximum(dimx-1)<br><br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig2.setValue(ncy)<br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig2.setMinimum(0)<br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig2.setMaximum(dimy-1)<br><br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig3.setValue(ncz)<br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig3.setMinimum(0)<br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig3.setMaximum(dimz-1)<br><br>        <font color="orange">self.</font><font color="orange">ui.</font>lineEdit_scrlbr1.textChanged.connect(partial(<font color="orange">self.</font>setSliderFromText,<font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig1))<br>        <font color="orange">self.</font><font color="orange">ui.</font>lineEdit_scrlbr2.textChanged.connect(partial(<font color="orange">self.</font>setSliderFromText,<font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig2))<br>        <font color="orange">self.</font><font color="orange">ui.</font>lineEdit_scrlbr3.textChanged.connect(partial(<font color="orange">self.</font>setSliderFromText,<font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig3))<br><br>        <font color="orange">self.</font>currentSliceX = ncx<br>        <font color="orange">self.</font>currentSliceY = ncy<br>        <font color="orange">self.</font>currentSliceZ = ncz<br>        <font color="orange">self.</font>updateAll()<br><br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig1.valueChanged[int].connect(<font color="orange">self.</font>updateSliceX)<br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig2.valueChanged[int].connect(<font color="orange">self.</font>updateSliceY)<br>        <font color="orange">self.</font><font color="orange">ui.</font>scrlbr_fig3.valueChanged[int].connect(<font color="orange">self.</font>updateSliceZ)<br><br>        <font color="orange">self.</font>clim1 = <font color="orange">plt.</font>getp(<font color="orange">plt.</font>getp(<font color="orange">self.</font>slice1,'images')[0],'clim')<br>        <font color="orange">self.</font>clim2 = <font color="orange">plt.</font>getp(<font color="orange">plt.</font>getp(<font color="orange">self.</font>slice2,'images')[0],'clim')<br>        <font color="orange">self.</font>clim3 = <font color="orange">plt.</font>getp(<font color="orange">plt.</font>getp(<font color="orange">self.</font>slice3,'images')[0],'clim')<br><br>        <font color="orange">self.</font>lockColormap = <font color="orange">True<br></font>        <font color="orange">self.</font><font color="orange">ui.</font>checkBox_lockcmap.setChecked(True)<br><br><br>    <font color="orange">def </font>updateSliceX(self, nx):<br>        <font color="orange">self.</font>slice1.imshow(np.squeeze(<font color="orange">self.</font>volume[nx, :, :]))<br>        <font color="orange">if </font><font color="orange">self.</font>lockColormap:<br>            <font color="orange">plt.</font>setp(<font color="orange">plt.</font>getp(<font color="orange">self.</font>slice1,'images')[0],'clim',<font color="orange">self.</font>clim1)<br>        <font color="orange">self.</font>canvas1.draw()<br><br>    <font color="orange">def </font>updateSliceY(self, ny):<br>        <font color="orange">self.</font>slice2.imshow(np.squeeze(<font color="orange">self.</font>volume[:, ny, :]))<br>        <font color="orange">if </font><font color="orange">self.</font>lockColormap:<br>            <font color="orange">plt.</font>setp(<font color="orange">plt.</font>getp(<font color="orange">self.</font>slice2,'images')[0],'clim',<font color="orange">self.</font>clim2)<br>        <font color="orange">self.</font>canvas2.draw()<br><br>    <font color="orange">def </font>updateSliceZ(self, nz):<br>        <font color="orange">self.</font>slice3.imshow(np.squeeze(<font color="orange">self.</font>volume[:, :, nz]))<br>        <font color="orange">if </font><font color="orange">self.</font>lockColormap:<br>            <font color="orange">plt.</font>setp(<font color="orange">plt.</font>getp(<font color="orange">self.</font>slice3,'images')[0],'clim',<font color="orange">self.</font>clim3)<br>        <font color="orange">self.</font>canvas3.draw()<br><br>    <font color="orange">def </font>updateAll(self):<br>        <font color="orange">self.</font>updateSliceX(<font color="orange">self.</font>currentSliceX)<br>        <font color="orange">self.</font>updateSliceY(<font color="orange">self.</font>currentSliceY)<br>        <font color="orange">self.</font>updateSliceZ(<font color="orange">self.</font>currentSliceZ)<br><br>    <font color="orange">def </font>toggleLockCmap(self):<br>        <font color="orange">if </font><font color="orange">self.</font><font color="orange">ui.</font>checkBox_lockcmap.isChecked():<br>            <font color="orange">self.</font>clim1 = <font color="orange">plt.</font>getp(<font color="orange">plt.</font>getp(<font color="orange">self.</font>slice1,'images')[0],'clim')<br>            <font color="orange">self.</font>clim2 = <font color="orange">plt.</font>getp(<font color="orange">plt.</font>getp(<font color="orange">self.</font>slice2,'images')[0],'clim')<br>            <font color="orange">self.</font>clim3 = <font color="orange">plt.</font>getp(<font color="orange">plt.</font>getp(<font color="orange">self.</font>slice3,'images')[0],'clim')<br>            <font color="orange">self.</font>lockColormap = <font color="orange">True<br></font>        else:<br>            <font color="orange">self.</font>lockColormap = <font color="orange">False<br></font><br>    <font color="orange">def </font>setSliderFromText(self, slider, text):<br>        slider.setValue(toInt(text))<br><br>    <font color="orange">def </font>setTextFromSlider(self, lineedit, value):<br>        lineedit.setText(toQString(value))</code></body>
    </html>